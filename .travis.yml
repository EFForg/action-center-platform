sudo: required
language: generic
services:
  - docker
before_install:
  - docker pull postgres
  - docker run -d --name=testdb -e POSTGRES_PASSWORD=mysecretpassword postgres
  - docker build -t app .
script:
  - docker run --link testdb:testdb -e test_db_adapter=postgresql -e test_db_database=postgres -e test_db_username=postgres -e test_db_password=mysecretpassword -e test_db_encoding=utf8 -e TEST_DB_AUTO_MIGRATE=true -e cors_allowed_domains="https://standagainstspying.org https://www.standagainstspying.org http://localhost:8080 http://nobitcoinlicense.org https://nobitcoinlicense.org" -e call_tool_url='https://call.eff.org/call/create' -e call_tool_api_key='' -e storage='s3' -e twitter_handle='eff' -e twitter_related='eff efflive' -e facebook_handle='eff' -e amazon_region=us-west-1 -e amazon_bucket=actioncenter-staging -e secret_key_base=0a146fe6f02dcf907a162e81209cd148684ddcb447786d6aa5b5ef691a14240ecc5c0f74ef89e3f784cdfc04868197da8a5b606632b9307564f302048162cf1a -e devise_secret_key=0a146fe6f02dcf907a162e81209cd148684ddcb447786d6aa5b5ef691a14240ecc5c0f74ef89e3f784cdfc04868197da8a5b606632b9307564f302048162cf1a -e time_zone='Pacific Time (US & Canada)' -e smtp_username=$smtp_username -e smtp_password=$smtp_password -e smtp_address=$smtp_address -e mailings_from='EFF Action <actioncenter@eff.org>' -e smarty_streets_id=$smarty_streets_id -e smarty_streets_token=$smarty_streets_token -e amazon_access_key_id=$amazon_access_key_id -e amazon_secret_access_key=$amazon_secret_access_key -e amazon_bucket_url=act.s.eff.org -e supporters_api_key=test -e DISABLE_PUFFING_BILLY_REQUESTS=true -e ROLE=test app bash -c "bundle exec rspec spec && bundle exec cucumber"
  - docker run app bash -c "bundle exec rubocop"
  - docker run app node_modules/.bin/sass-lint -vq

env:
  global:
    - secure: "bkG4YFYUy0XLXsgW5IRfuCbQ4Mtx2R3FSOabsRT6SYYtFXwOyzJyljXbBKc69sBMTKkVTZJyLSxo9p/ymwF1xN3nnZ4enY6VRcKzvB+bFyIOf8eGyRU6asyzGm5Jtfg93sLk37Qcwm8rGdvXoctIwPlEicsui3b2/ZauRDPN9szjzdYg6HEOggXolsJUbf9t96FjTH4fEVOsquB7zeDPAGhrsEEStcHxWSGOxho1PIP3HLaTs+8GC5RozZszt3W65NTxwrq6k1pdS//RbA3B+qm2kZ/jOzibk3uMkxNzlVpVAVAmGT0gf6MNmoDKROTZAiV5cDw/QjsHPjdHGZZEWtQ7yfWJK7kpnY7btqOxsk0WR5Kp8lhn8Nhb2+6X5vQSzCvosQQ/NeLuBA/CZPPeZFhpTd7zDNoU8NN/dW5Bv/QXq0sYEsH1pcoRQWTZ8NkYdz2kQf8K0zOg1h/ZM5bT0dwUOx4AKbU4J9yPLAzXfmQTvkk8e+uU+DUjNST+qezgoaNbhYuCqb/PzIwZPs1m8g1l6hZvoaK/nUz6SQFKx1hDvR5K9qeETpYItOE1aexBMcnC58i/CUCELz6F9GOwmtw9EIOCT3C6bVKQaUp8DPgCg0sddceDbyOC2+Tg1UIYuZGhK3cGg8LKiEwxQX9/XyNyQ8HdmkGCbO2HRRrg/UE="
    - secure: "AcuWayicWelORXm3Wa2boYZK6CX47pxltS1k62YzNXaUGIZEff+P17w/vYs5ehxAyxpjFxMzewszL4WYzQcsVqHf1nKBvwQUiAPQCWVgILL0dwaBHqZyj16i9gd1c/cJ+GfKLTPOy1qPmiW9QheSWCMCGbrRwWRS9XHy44QzS+a7r053acJxmXehLH0oGKBuVpajCtr0Wq1WDHKlvJ5HNPx3Qn1ktUwHJMA/QjDAwIAeVXEN90s7/IeBr1iquc8VkPUqzy9N0HnFPIbywyBfldlszoGmDe84kOS0pX//c1zQmNBR9DiKuFZ2bOqZM9Bqae4XUXYdgS5m6MPgCk6BOY8hDYv1GwAZuNxfBfZ9DIaV7ZQfs7wbXVvgJu/wSQpyKfyjy/m2OHJxEuDjqCdYvozBgTOqWNKbqO2Yx3Alkm7Kwjpl0C4F5n7N6PYRxtvvk7Vgp/erw46RSvtMFEgZaghh0hke0eQ6EwTRbjta76c99FKKlsc/lxfHQ2RNXxztSI80pHaV20ZVF3dqcaPsct1jWasM5rHpIrwPCIgb/Waj046CTjD3ZDTPpsPluT6qKyMjDbmeR3BLoS8F6jcRnsBZeDzVtlNBsp1tHff54QR+r+ql0uQHCBZN+dMerKdtru0ZMjatcLDhzWCT6ZHK/hdbjW1DbTsg0A/5HqmNZL8="
    - secure: "AupV7jxr992kX/orXCaS0dNLxcURQxDlS15d3kpdUtXAIy1rFI948yfYlmIoYCyt5/zQxoHo+fuOmL19nZpqqmeRi1NhWZ0z7g6QOjJXCLsNJGq7Gx1bDqihOBIz/X0ki5tG7BK/1yfrjMljFirRy1sC+fhH7DWLDFhba1Kxi3xOaV6kfU+Z79kV7ZrKdOpgRPTv0Bcl+Q99Z4OcpgWxP76w1kjkxDruoLjH69iS06t7CnADaPTDScnPJiVZX3NXiR3IRVIHm+Aj9mK1MvUBWsIlKBXRMyikhCGWJWvmG5Llftv8ddL2yiCiLbpyaejeftzJFPL4wtr4jC5cibNIrO839WuIrEq/IBSAUYn2m9SXGwMw6lmPQQ9mDoFnhUuUybej5gv2XIrYqu5PebV7KJc3C1lu8N0DjTaLFc/hWtZc40EguSMZYockFEePBdQJfhyMxhPR6SB7oY0P/A1JtOhzFsTt4jpxtexUxTeowZ3jF0aI1TaymHwQlDQGdbpTF+cGoS/ajG2dRROXj3usjvtLn/z+ZIQJiJQEBj0Z1r1TtUO+2xiRvZB3D9gLKxAun1xRoUuF1/1OOCh2pWZFu21tnQbnB5iJmKSTYBnPYA1kXShgVOIlvNEghDD+Ry8+InXNNGv03e7zepCpKJ1jdzvxU+D2i/ukkQmhPk7lobw="
    - secure: "qCNeMBafuwMhWQeYgAT+z6ilIuzHopZe14CuUY9cCXveIp39KJiqB0YMyLrmhIzyqZMzUvWePYVZWGX8KCoXGdPsnpnHPJvjO8UjNdHaprUOj0fBf42reYT+dBEcwaSpwyFQVS507VvoxXLrJh7losC8/BpJAdxvuQZuRE2wk1+utF5llVks7k/qXmL0UuqNyWzm1BXSyUhMrv9NNqzyky5slSPlkbHP6RtjHruFE1NdMQ8otAGoAWPAPH11SsM2PB2ADyqpV1GOBheq+gc1wDhc4u2xSNAhvlURd4rSy9vyrKIxnDJaVkU5G4WI5LjRd9u2MY/Ih6tmDwi74ozoqx7XR30vDmMC4Gvrp4jRi/0xFhKL31oIEMy+6LOVzs94mjVLl4kJ4VXyP5jVe/bN0gANbF9tuWVrMBcqrWc16QqngqP00B2La7QroocNMe2k/l16igX5IZaqk4blqApbkCxvVkrdQnx6pkq5+oZD8mgXIhkwKjM5gbA8inuXwo/o0GKEF1lnNRsczziShGd2JZQcP/V+jlNnBV2Y2LG9LkrRO1brytgXISRIvLPvOX4a7eUGRqqJtiTaOai8miX6voOKQxnVJfBSyDiKsC0wTs26Erx0gP6+myoHRlcLRLqnpPk6T078NEp7bnZ3QqaPuvCIlVDM+/fn1Aa9FS5ZpDw="
    - secure: "NDR5rz4P4rGvIKMNUzFx1In7KXPXV6rf/jeHKhBcFqXemnfy0xHVHp7pQBGnM0Uz+gbXfz64fJVRJlov6V2RzQNpupG7Bais0O3M2ZYuhCdrh4uuo4GGRCdRFtEW3drHJdzMJyJofPyEwtY2oY3d4mL3IFXSa4C18RETRD32L/MkD43FEf92csj0U/uejzZ1eSAh4DU2o0N7lB+TTaMEnjKmpNgXlf1kwjNfCBBsk5pPi9Gp3q8aclnuxAupMr7r0klfpNhJaziKCE+HU6ftUNyJUxbCbSJ4kymndtcOP2bLOWYwKpOa51wYNmg1P9QYb8ycc1G9lD7MQQjpOfYd1cTC8OIwi/A3CpPmG76O5dWumyrF2qeLUPMQJiarWNTX+wtJgQB+1t4ydJPUGha0jEkC9LoCCNBg787JZaz13Arwd5icjkwgQSAAEI1Kieu92D1K+5eW7LU9vIFwrr43KEIM7Tf9t4Xcg1LZkAkzGrgv3WY8iZNWTgLsbzOSfj0tnyrNzhFstiFSx4MXN247dSjnEfLWip3OxxEdTKwunOOq9G8ujpaWJBfUTRdGHOgWuSN7iit5E6aqtqh9QktOQHnjNIuLbSSzZrEmJ5noflvI6WWIt/CPKKw628xGgwc5jCbOI2LMFMyPGIpw9EdY59Ed4syfK1UCK2pPwRGATIc="
    - secure: "rklqIXX/FqdTC2MIbC+H3PvzImAJ4q372hhtkXW2+UoOp8waH/6J6pMCeUbfJzaA4S2gGN76HrChFc6Da/PjZZGXwgFi0Ooba3gJPbKE108O5erPFWcQ/XUbqecySoOumJma4hUvdJ+9luZOSBJRBBuIyeVESUsmihc4rUZNWBYDTRcLub7Bx+ksbJUtmrK0zbSgXRlz8qFTVCc65CmJeeNstrqAHzy8q+Ngxvaf20z4qhd9RSpjz36JNXZcnZQQKS37d2yR/lOOWQNUhhMCZtE+Nb3uCIGmIQANySOPcU5KRzoHD6etWfDTFjNtVCv0roePytTHmtvQvljnODFo/VLJRYU8aqML7cyrh4lBHYO2Pf1ZgMu4hEZ0igqMvQvtMNCuhrmxx5Kzpm1o6MWYbl9prTu5clrPNSTTNi4lk2PNezt7JsJDJd/UKXd335v4Vwlm72zwST8q0iy2D2wtJJEDE7l2a2QTtRowHSROQS+xxgQMe5SOLgENPqt09th0NIlnsh0/i0evuHd5fp/UwtCjVJPI7dRJ42MBpDVTP8I3ulS22pZP3rxRtsGV5E2l/7yD3DMcvXR3HmR2UO+IuwXlghCNUcl82lnuCj5fb9lVDulmflKN9kRHErnVjCGSSjodXxSSxKN2KHcoLHN9PTwvSLR7wyOnfjq4TTH5G5M="
    - secure: "QOPLIj5E5hejocIFPM+jHXF9HRLAu11QzvIiqEgJfUPD8ZodpmeFPNwEQ5WHWLGqJPQQARtf5PtMzqjIxVwEW+6jlQKWnKHlZr8WamnXvF4+ie288JbnFEUQHhzOb+LG+DdlpzCndOGJsZp0A3d/1yprFUqBylQsE1aY9lmcJ2gIz+1Zix/Cl24iqSuHxbZwBz1jZWaLTDWSq6NBzo/kKI4py2cBMVemNghpBAA38FVh8h1rIf7xG/cRM07RlG8W4lMwfut0g39F1MxAoUK+D9slg/H6eTyU4ZU+1sO84nBsbUtFeU2G1wn8uE09hn6hqVS/fg+HbCiT8wGwFtoaX6dT9BdgumV7v7EUoLCD7ilGgxfUVxUmjZOp1dvcj5AlfrXERB0tPmmpB4kgJ8lF8/U4pU0j5/AaNjsgFiIrS5MEZIaPjDpDOulDgpcsJ7NaOEPTN4lqivmDvI1LDPR88EmkXgxqtqebaxgttlkcWnCLQZs8DVcjE29xquQFAh8sOhWm3tm5lCFsu8HOOsxFP9LdS/fT3PBeqpIlzJceSiJRusTQibE7M5NjK8X/SkrPsSSI5RnMeksy4kxIO3rgNk5LOBjEil+9iK/vBaCybyceH8C2addnJvOd/r64SbPMAqCgP6RtAjyh/mG8OM7fL3MnUBrjFSOmnp7w/rZM018="
